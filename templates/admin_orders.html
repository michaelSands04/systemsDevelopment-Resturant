{% extends "base.html" %}
{% block content %}
<h1 class="mb-3">Admin: Orders</h1>
<p class="text-muted">Manage latest orders (status updates are audited in Firestore).</p>

{% for o in orders %}
  <div class="card mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h5 class="mb-1">Order #{{ o.id }} <span class="text-muted">— {{ o.username }}</span></h5>
          <div class="text-muted small">{{ o.created_at }}</div>
        </div>

        <form method="post" action="/admin/orders/{{ o.id }}/status" class="d-flex gap-2">
          <select class="form-select form-select-sm" name="status">
            {% for s in ["pending","preparing","completed","cancelled"] %}
              <option value="{{ s }}" {% if o.status == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
          <button class="btn btn-sm btn-primary" type="submit">Update</button>
        </form>
      </div>

      <ul class="mt-3 mb-2">
        {% for it in items_by_order.get(o.id, []) %}
          <li>{{ it.qty }} × {{ it.name }} <span class="text-muted">(£{{ "%.2f"|format(it.unit_price) }})</span></li>
        {% endfor %}
      </ul>

      <div class="fw-bold">Total: £{{ "%.2f"|format(o.total_price) }}</div>
    </div>
  </div>
{% endfor %}
{% endblock %}
