{% extends "base.html" %}
{% block content %}

<h1 class="mb-3">Dashboard</h1>
<p class="text-muted">
  This page combines Cloud SQL (menu items) with Firestore (reviews + item_stats).
</p>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Top Rated Items</h5>

        {% if top_items and top_items|length > 0 %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Price</th>
                  <th>Avg Rating</th>
                  <th>Reviews</th>
                </tr>
              </thead>
              <tbody>
                {% for t in top_items %}
                  <tr>
                    <td>{{ t.name }}</td>
                    <td>
                      {% if t.price is not none %}
                        £{{ "%.2f"|format(t.price) }}
                      {% else %}
                        —
                      {% endif %}
                    </td>
                    <td>★ {{ t.avg_rating }}</td>
                    <td>{{ t.review_count }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="mb-0">No ratings yet. Submit some reviews first.</p>
        {% endif %}

      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Latest Reviews</h5>

        {% if latest_reviews and latest_reviews|length > 0 %}
          <div class="list-group">
            {% for r in latest_reviews %}
              <div class="list-group-item">
                <div class="d-flex justify-content-between">
                  <strong>{{ r.username or "anonymous" }}</strong>
                  <span>{{ r.rating }}/5</span>
                </div>
                <div class="small text-muted">
                  {{ r.item_name }}
                </div>
                <div class="mt-2">{{ r.comment }}</div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="mb-0">No reviews yet.</p>
        {% endif %}

      </div>
    </div>
  </div>
</div>

{% endblock %}
